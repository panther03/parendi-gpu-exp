import subprocess

threadcnts = [64,1024,4096,8192,16384,24576,32768]
fpts = [10,100,1000,10000]

datasets = []

'''
for fpt in fpts:
    dataset = []
    for threadcnt in threadcnts:
        p = subprocess.run(["./build/xorSync", str(fpt), str(threadcnt)], capture_output=True)
        print(p.stderr.decode('utf-8'))
        res = p.stdout.decode('utf-8')[:-1].split(",")
        dataset.append((float(res[0]), float(res[1])))
    datasets.append(dataset)

print(datasets)
with open("datasets.txt", 'w') as f:
    f.write(str(datasets))
    f.write("\n")

exit(0)
'''

datasets = [[(854.579, 0.0), (854.462, 0.0), (854.408, 0.0), (854.51, 0.0), (856.723, 0.0), (868.072, 0.0), (1088.23, 0.0)], [(6630.54, 0.0), (6629.63, 0.0), (6647.0, 0.0), (6646.53, 0.0), (6647.96, 0.0), (6818.07, 0.0), (7747.38, 0.0)], [(64764.1, 0.0), (64756.3, 0.0), (64749.9, 0.0), (64923.7, 0.0), (64884.3, 0.0), (66397.6, 0.0), (76644.4, 0.0)], [(647066.0, 0.0), (646920.0, 0.0), (646881.0, 0.0), (646694.0, 0.0), (647454.0, 0.0), (662883.0, 0.0), (780948.0, 0.0)]]
# datasets = [[(0.0, 1586.82), (0.0, 1593.41), (0.0, 1593.56), (0.0, 1593.93), (0.0, 1589.48), (0.0, 1602.5), (0.0, 2781.02)], [(0.0, 7344.51), (0.0, 7344.01), (0.0, 7366.91), (0.0, 7368.05), (0.0, 7372.2), (0.0, 14350.2), (0.0, 16193.9)], [(0.0, 65484.8), (0.0, 72324.6), (0.0, 65479.1), (0.0, 65621.5), (0.0, 65612.0), (0.0, 131953.0), (0.0, 148556.0)], [(0.0, 647591.0), (0.0, 1294660.0), (0.0, 1290550.0), (0.0, 1289770.0), (0.0, 1294100.0), (0.0, 1308140.0), (0.0, 1491620.0)]]
#datasets = [[15.7912, 19.2178, 19.1396, 32.1305, 30.0782, 33.9752, 37.1612], [48.8832, 60.6431, 60.5936, 63.871, 71.6325, 77.3887, 80.995], [89.2259, 94.3231, 94.2753, 78.3594, 81.0652, 85.3082, 80.2053], [98.0072, 62.118, 62.2408, 76.4811, 82.9937, 86.8695, 81.2124]]
# datasets = [[(102.512, 649.931), (129.907, 676.2), (129.897, 678.736), (222.039, 691.422), (323.001, 1074.11), (423.229, 1244.89), (522.947, 1406.76)], [(530.51, 1085.26), (832.687, 1373.29), (833.491, 1372.88), (1616.65, 2531.69), (2404.13, 3333.08), (3193.89, 4133.76), (3981.0, 4929.15)], [(4953.5, 5555.32), (7959.33, 8437.6), (7978.58, 8465.14), (15724.0, 20063.3), (23480.8, 28943.3), (31311.8, 36694.6), (39130.9, 48770.6)], [(49221.3, 50236.7), (79099.7, 127279.0), (79344.2, 127479.0), (157005.0, 205284.0), (234818.0, 282908.0), (312864.0, 360478.0), (390710.0, 481042.0)]]

# plot each dataset as a line graph
import matplotlib.pyplot as plt

for i, dataset in enumerate(datasets):
    plt.plot(threadcnts, list(map(lambda x: dataset[0][0]/x[0], dataset)), label=f"FPT: {fpts[i]}")

plt.xlabel("Thread Count")
plt.ylabel("Rate")
plt.legend()
plt.savefig('nosync.png')
exit(0)

plt.close()
for i, dataset in enumerate(datasets):
    plt.plot(threadcnts, list(map(lambda x: dataset[0][0]/x[0], dataset)), label=f"FPT: {fpts[i]}")

plt.xlabel("Thread Count")
plt.ylabel("Rate")
plt.legend()
plt.savefig('nosync.png')
